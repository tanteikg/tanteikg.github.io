<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Decent Oracles</title>
    <script src="PoAO.js"></script>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <script>
        function generate_proof() {
		mime_type= "text/plain";
		var a = document.getElementById("cli_message").value;
		var b = document.getElementById("cli_secret").value;
		result = Module.ccall('generate_poc','string',['string', 'string', 'string'],[a,b, "1E"]);
		const obj = JSON.parse(result)
		let wallet = obj.wallet
		var blob = new Blob([result],{type:mime_type});
		var dlink = document.createElement('a');
		dlink.download = wallet + ".json";
		dlink.href = window.URL.createObjectURL(blob);
		dlink.onclick = function(e) {
			var that = this;
			setTimeout(function() {
				window.URL.revokeObjectURL(that.href);
			}, 1500);
		};
		dlink.click();
		dlink.remove();

		var rc = document.getElementById("ret") 
		rc.innerText = "Proof generated for " + wallet
		Module._clearbuf(result)
        }
        function verify_proof(filehandle) {
		var prooffile = filehandle.files[0];
		var fr = new FileReader();
		fr.readAsText(prooffile);
		fr.onload = function() 
		{
			const obj = JSON.parse(fr.result)
			let wa = obj.wallet
			let walletname = wa+".txt"
			Module['FS_createDataFile']('/', walletname, fr.result, true, true, true);
			var result = Module.ccall('verify_poc','string',['string'],[walletname]);
			filehandle.value = '';
			 Module['FS_unlink'](walletname);
			var rs = document.getElementById("res");
			rs.innerText = result
			document.getElementById("tw").innerHTML = '<a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-show-count="false" data-size="large" data-via="tanteikg" data-text="I created my public key zero-knowledge proof for Dogecoin wallet '+wa+'. You can do it too.\n\n">Tweet</a>'
			        twttr.widgets.load()
			Module._clearbuf(result)
    		};

	}
    </script>
  </head>
  
  <body>
    <h2>Welcome to Proof of Address Ownership page!</h2>
    <p>This is a demo page for the Proof Generation (at client) and Proof Verification (on server) of Dogecoin wallet addresses to take place.</p>
    <h3>Client (Please do this offline if you are working on production secrets)</h3>
    <div style="display: inline-block;">
<p>Enter public key:&nbsp; <input id="cli_secret" type="password"/> </p>
<p>Enter user name (max 20 chars):&nbsp; <input id="cli_message" /> knows the public key to this address</p>
<button id="gen_button" onclick="generate_proof()">Generate</button>
<p>Result:&nbsp; <label id="ret"></p>
    </div>
<hr />
   <h3>Server&nbsp;</h3>
    <div style="display: inline-block;">
   <p>Upload Proof: &nbsp; <input id="svr_proof" type="file" onChange={verify_proof(this)} /> </p>
   <p>Result:<label id="res"></p>
    </div>
    <div id=tw>
   </div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Copyright pQCee 2022-23. All rights reserved.&nbsp;</p>
  </body>
</html>
